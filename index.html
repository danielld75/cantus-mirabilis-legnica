<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Cantus Mirabilis – Kalendarium</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--
      Opis zmian dodanych w tym pliku (2026-01-21):
      - Dodano sekcję administracyjną z logowaniem (nazwa użytkownika: "Cantus", hasło: "mirabilis#2026").
      - Po poprawnym zalogowaniu wyświetlany jest formularz dodawania wydarzeń (data, tytuł, miejsce, czas, typ).
      - Nowe wydarzenia są dodawane do kalendarza w czasie rzeczywistym i zapisywane w localStorage (klucz: "cm_events_custom").
      - Eventy z localStorage są łączone z listą wbudowaną w skrypt (pole `events`) przy ładowaniu strony.
      - UI minimalnie zmienione (sekcja admin pod kalendarzem). Autoryzacja jest realizowana po stronie klienta (JS) — to wystarczy dla prostego, statycznego repozytorium GitHub Pages.
      Uwaga: ponieważ strona jest statyczna, autoryzacja po stronie klienta nie jest bezpieczna dla poufnych danych — służy tu jako prosty mechanizm dostępu.
    -->

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold: #c9a24d;
            --dark: #0b0b0b;
            --panel: #171717;
            --text: #eaeaea;
        }

        body {
            margin: 0;
            background: radial-gradient(circle at top, #222, #000);
            color: var(--text);
            font-family: 'Inter', sans-serif;
        }

        section {
            margin-bottom: 3rem;
        }

        /* ===== FADE-IN ===== */
        .fade {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 1.2s ease, transform 1.2s ease;
        }

        .fade.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ===== HEADER ===== */
        header {
            text-align: center;
            padding: 4rem 1rem 3rem;
        }

        header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.2rem;
            letter-spacing: 3px;
            color: var(--gold);
        }

        header p {
            opacity: 0.8;
            font-size: 1.2rem;
        }

        /* ===== MAIN ===== */
        main {
            max-width: 1100px;
            margin: auto;
            padding: 2rem 1rem 4rem;
        }

        /* ===== CALENDAR ===== */
        .calendar {
            background: var(--panel);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 0 60px rgba(201,162,77,.15);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-header h2 {
            font-family: 'Playfair Display', serif;
            color: var(--gold);
        }

        .calendar-header button {
            background: none;
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: .4rem .9rem;
            border-radius: 10px;
            cursor: pointer;
        }

        .weekdays, .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
        }

        .weekdays div {
            opacity: .5;
            padding: .6rem 0;
        }

        .days div {
            padding: .9rem 0;
            cursor: pointer;
            border-radius: 10px;
            transition: .2s;
        }

        .days div:hover {
            background: rgba(201,162,77,.18);
        }

        .day.has-event {
            border: 1px solid var(--gold);
        }

        .day.today {
            box-shadow: inset 0 0 0 2px rgba(201,162,77,.12);
        }

        /* ===== EVENTS ===== */
        .events {
            background: var(--panel);
            border-radius: 20px;
            padding: 1.5rem;
        }

        .events h3 {
            font-family: 'Playfair Display', serif;
            color: var(--gold);
        }

        .event {
            margin-top: 1rem;
            padding-left: 1rem;
            border-left: 4px solid var(--gold);
        }

        .event.liturgia { border-color: #6b8e23; }
        .event.koncert { border-color: #8b0000; }
        .event.inne { border-color: #4682b4; }

        /* ===== ADMIN ===== */
        .admin {
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            border: 1px solid rgba(255,255,255,0.03);
        }

        .admin form {
            display: grid;
            gap: .6rem;
            grid-template-columns: 1fr;
        }

        .admin input, .admin select, .admin button {
            padding: .6rem .8rem;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.06);
            background: transparent;
            color: var(--text);
        }

        .admin .row {
            display:flex;
            gap:.6rem;
        }

        footer {
            text-align: center;
            padding: 2rem;
            opacity: .5;
        }

        .hint {
            opacity:.7;
            font-size:.95rem;
            margin-top:.5rem;
        }
    </style>
</head>

<body>

<header class="fade">
    <h1>CANTUS MIRABILIS</h1>
    <p>Kalendarium i repertuar chóru • 2026</p>
</header>

<main>

    <section class="calendar fade">
        <div class="calendar-header">
            <button onclick="changeMonth(-1)">◀</button>
            <h2 id="monthYear"></h2>
            <button onclick="changeMonth(1)">▶</button>
        </div>

        <div class="weekdays">
            <div>Pn</div><div>Wt</div><div>Śr</div><div>Cz</div>
            <div>Pt</div><div>Sb</div><div>Nd</div>
        </div>

        <div class="days" id="days"></div>
    </section>

    <section class="events fade" id="eventList">
        <h3>Wydarzenia</h3>
        <p>Wybierz dzień w kalendarzu</p>
    </section>

    <!-- ===== ADMIN: LOGIN + FORM ===== -->
    <section class="admin fade" id="adminSection" aria-hidden="false">
        <h3 style="color:var(--gold);margin:0 0 .5rem 0;font-family:'Playfair Display',serif;">Panel administratora</h3>

        <div id="loginArea">
            <form id="loginForm" onsubmit="event.preventDefault(); tryLogin();">
                <div class="row">
                    <input id="username" placeholder="Nazwa użytkownika" required value="">
                    <input id="password" type="password" placeholder="Hasło" required value="">
                </div>
                <div class="row">
                    <button type="submit">Zaloguj</button>
                    <button type="button" onclick="logout()" style="background:transparent;border:1px solid rgba(255,255,255,0.06);">Wyloguj</button>
                </div>
                <div class="hint">Dostęp do formularza jest zahasłowany. Nazwa użytkownika: <strong>Cantus</strong>, hasło: <strong>mirabilis#2026</strong></div>
            </form>
        </div>

        <div id="adminFormArea" style="display:none;margin-top:1rem;">
            <form id="addEventForm" onsubmit="event.preventDefault(); addEventFromForm();">
                <div class="row">
                    <input id="evDate" type="date" required>
                    <input id="evTime" type="time" required>
                </div>
                <input id="evTitle" placeholder="Tytuł wydarzenia (np. Niedziela, Koncert Kolęd)" required>
                <input id="evPlace" placeholder="Miejsce (np. Katedra)" required>
                <div class="row">
                    <select id="evType" required>
                        <option value="liturgia">liturgia</option>
                        <option value="koncert">koncert</option>
                        <option value="inne">inne</option>
                    </select>
                    <button type="submit">Dodaj wydarzenie</button>
                </div>
                <div class="hint">Nowe wydarzenia zostaną zapisane lokalnie (localStorage) i po dodaniu będą widoczne w kalendarzu.</div>
            </form>

            <div style="margin-top:.8rem;">
                <button onclick="exportCustomEvents()" style="padding:.5rem .8rem;border-radius:8px;border:1px solid rgba(255,255,255,.06);">Eksportuj wydarzenia (JSON)</button>
                <button onclick="clearCustomEvents()" style="padding:.5rem .8rem;border-radius:8px;border:1px solid rgba(255,255,255,.06);margin-left:.5rem;">Usuń zapisane wydarzenia</button>
            </div>
        </div>
    </section>

</main>

<footer>
    © Cantus Mirabilis • GitHub Pages
</footer>

<script>
    /* ===== EVENTS DATA ===== */
    const defaultEvents = {
        "2026-01-25":[{title:"Niedziela", place:"Katedra", time:"18:30", type:"liturgia"}],
        "2026-02-01":[{title:"Koncert Kolęd", place:"Katedra", time:"16:30", type:"koncert"}],
        "2026-02-15":[{title:"Niedziela", place:"Katedra", time:"10:00", type:"liturgia"}],
        "2026-03-08":[{title:"Niedziela", place:"Katedra", time:"13:00", type:"liturgia"}],
        "2026-03-29":[{title:"Niedziela Palmowa", place:"Katedra", time:"10:00", type:"liturgia"}],
        "2026-04-02":[{title:"Wielki Czwartek – Msza Krzyżma", place:"Katedra", time:"10:00", type:"liturgia"}],
        "2026-04-03":[{title:"Wielki Piątek", place:"Katedra", time:"18:30", type:"liturgia"}],
        "2026-05-10":[{title:"Niedziela", place:"Katedra", time:"13:00", type:"liturgia"}],
        "2026-05-24":[{title:"Niedziela", place:"Katedra", time:"18:30", type:"liturgia"}],
        "2026-06-04":[{title:"Boże Ciało Czwartek", place:"Katedra", time:"10:00", type:"liturgia"}],
        "2026-06-28":[{title:"Niedziela, Wigilia odpustu Katedry", place:"Katedra", time:"18:30", type:"liturgia"}],
        "2026-09-19":[{title:"Wigilia Poświęcenia Kościoła św Ap. Piotra i Pawła", place:"Katedra", time:"18:30", type:"liturgia"}],
    };

    // Klucz localStorage dla wydarzeń dodanych przez admina
    const STORAGE_KEY = "cm_events_custom";

    // Połączone eventy (domyślne + custom)
    let events = {};

    /* ===== CALENDAR ===== */
    let currentDate = new Date();

    function mergeEvents() {
        // Klonujemy domyślne wydarzenia
        events = JSON.parse(JSON.stringify(defaultEvents));

        // Ładuj custom z localStorage
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){
            try {
                const custom = JSON.parse(raw);
                for(const k in custom){
                    if(!events[k]) events[k] = [];
                    // upewnij się, że to tablica
                    if(Array.isArray(custom[k])) events[k] = events[k].concat(custom[k]);
                }
            } catch(e) {
                console.warn("Błąd parsowania custom events:", e);
            }
        }
    }

    function renderCalendar() {
        mergeEvents();

        const daysEl = document.getElementById("days");
        daysEl.innerHTML = "";
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        document.getElementById("monthYear").textContent =
                currentDate.toLocaleString("pl-PL",{month:"long",year:"numeric"});

        let firstDay = new Date(year, month, 1).getDay() || 7;
        let daysInMonth = new Date(year, month+1, 0).getDate();

        for(let i=1;i<firstDay;i++) daysEl.appendChild(document.createElement("div"));

        for(let d=1;d<=daysInMonth;d++){
            const key = `${year}-${String(month+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
            const div = document.createElement("div");
            div.textContent = d;
            div.className = "day";
            if(events[key]) div.classList.add("has-event");

            // oznacz dzisiejszą datę
            const today = new Date();
            if(today.getFullYear() === year && today.getMonth() === month && today.getDate() === d){
                div.classList.add("today");
            }

            div.onclick = ()=>showEvents(key);
            daysEl.appendChild(div);
        }
    }

    function showEvents(key){
        const list = document.getElementById("eventList");
        const label = new Date(key).toLocaleDateString("pl-PL", {year:'numeric',month:'long',day:'numeric'});
        list.innerHTML = `<h3>${label}</h3>`;
        if(!events[key]){
            list.innerHTML += "<p>Brak wydarzeń</p>";
            return;
        }
        events[key].forEach(e=>{
            list.innerHTML += `
      <div class="event ${e.type}">
        <strong>${e.title}</strong><br>
        <span>${e.place} • ${e.time}</span>
      </div>`;
        });
    }

    function changeMonth(n){
        currentDate.setMonth(currentDate.getMonth()+n);
        renderCalendar();
    }

    /* ===== ADMIN (client-side) ===== */
    const ADMIN_USER = "Cantus";
    const ADMIN_PASS = "mirabilis#2026";
    let isLogged = false;

    function tryLogin(){
        const user = document.getElementById("username").value || "";
        const pass = document.getElementById("password").value || "";
        if(user === ADMIN_USER && pass === ADMIN_PASS){
            isLogged = true;
            document.getElementById("loginArea").style.display = "none";
            document.getElementById("adminFormArea").style.display = "block";
            alert("Zalogowano poprawnie.");
        } else {
            alert("Błędna nazwa użytkownika lub hasło.");
        }
    }

    function logout(){
        isLogged = false;
        document.getElementById("loginArea").style.display = "block";
        document.getElementById("adminFormArea").style.display = "none";
        document.getElementById("loginForm").reset();
    }

    function addEventFromForm(){
        const date = document.getElementById("evDate").value;
        const time = document.getElementById("evTime").value;
        const title = document.getElementById("evTitle").value.trim();
        const place = document.getElementById("evPlace").value.trim();
        const type = document.getElementById("evType").value;

        if(!date || !title || !place || !time) {
            alert("Wypełnij wszystkie pola.");
            return;
        }

        // data w formacie YYYY-MM-DD
        const key = date;

        const newEvent = { title, place, time, type };

        // Zapis do localStorage: najpierw odczytaj istniejące custom
        const raw = localStorage.getItem(STORAGE_KEY);
        let custom = {};
        if(raw){
            try { custom = JSON.parse(raw) || {}; } catch(e) { custom = {}; }
        }

        if(!custom[key]) custom[key] = [];
        custom[key].push(newEvent);

        localStorage.setItem(STORAGE_KEY, JSON.stringify(custom));

        // Zaktualizuj widok
        renderCalendar();
        // pokaż events dla tej daty
        showEvents(key);

        // wyczyść formularz częściowo
        document.getElementById("addEventForm").reset();
        alert("Wydarzenie dodane i zapisane lokalnie.");
    }

    function exportCustomEvents(){
        const raw = localStorage.getItem(STORAGE_KEY) || "{}";
        // Pobierz jako plik JSON
        const blob = new Blob([raw], {type: "application/json;charset=utf-8"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "cantus_custom_events.json";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
    }

    function clearCustomEvents(){
        if(!confirm("Czy na pewno usunąć wszystkie zapisane wydarzenia (localStorage)?")) return;
        localStorage.removeItem(STORAGE_KEY);
        renderCalendar();
        document.getElementById("eventList").innerHTML = "<h3>Wydarzenia</h3><p>Wybierz dzień w kalendarzu</p>";
        alert("Zapisane wydarzenia usunięte.");
    }

    /* ===== FADE-IN OBSERVER ===== */
    const observer = new IntersectionObserver(entries=>{
        entries.forEach(e=>{
            if(e.isIntersecting) e.target.classList.add("visible");
        });
    },{threshold:0.15});

    document.querySelectorAll(".fade").forEach(el=>observer.observe(el));

    // inicjalizacja: załaduj custom events i renderuj
    renderCalendar();
</script>

</body>
</html>
